"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@plasmicapp/host/registerComponent")),r=e(require("@plasmicapp/host/registerGlobalContext")),n=require("@plasmicapp/host"),a=require("@plasmicapp/query"),i=e(require("@sanity/client")),o=e(require("@sanity/image-url")),l=require("change-case"),s=e(require("dlv")),u=require("react"),c=e(u);function p(e,t,r,n,a,i,o){try{var l=e[i](o),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,a)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){p(i,n,a,o,l,"next",e)}function l(e){p(i,n,a,o,l,"throw",e)}o(void 0)}))}}var f,y=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=Object.create((t&&t.prototype instanceof p?t:p).prototype),i=new P(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return{value:void 0,done:!0}}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var l=b(o,r);if(l){if(l===c)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=u(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===c)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(e,r,i),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function p(){}function d(){}function f(){}var y={};l(y,a,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(j([])));m&&m!==t&&r.call(m,a)&&(y=m);var v=f.prototype=p.prototype=Object.create(y);function g(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var n;this._invoke=function(a,i){function o(){return new t((function(n,o){!function n(a,i,o,l){var s=u(e[a],e,i);if("throw"!==s.type){var c=s.arg,p=c.value;return p&&"object"==typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,o,l)}),(function(e){n("throw",e,o,l)})):t.resolve(p).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,l)}))}l(s.arg)}(a,i,n,o)}))}return n=n?n.then(o,o):o()}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function j(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:F}}function F(){return{value:void 0,done:!0}}return d.prototype=f,l(v,"constructor",f),l(f,"constructor",d),d.displayName=l(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},g(w.prototype),l(w.prototype,i,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,a,i){void 0===i&&(i=Promise);var o=new w(s(t,r,n,a),i);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(v),l(v,o,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=j,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;E(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(f={exports:{}}),f.exports),h=[{value:"==",label:"Equality"},{value:"!=",label:"Inequality"},{value:">",label:"Greater than"},{value:"<",label:"Less than"},{value:"<=",label:"Less than or equal"},{value:">=",label:"Greater than or equal "}];function m(e){if(null==e)throw new Error("Value must not be undefined or null");return e}var v="@plasmicpkgs/plasmic-sanity-io",g=function(e){return"currentSanity"+l.pascalCase(e)+"Item"};function w(e){return i({projectId:e.projectId,dataset:e.dataset,apiVersion:e.apiVersion?e.apiVersion:"v1",token:e.token,useCdn:e.useCdn})}var b=c.createContext(void 0),x={name:"SanityCredentialsProvider",displayName:"Sanity Credentials Provider",description:"Get your project ID, dataset, and token [here](https://www.sanity.io/manage).\n\nPlease also add 'https://host.plasmicdev.com' (or your app host origin) as an authorized host on the CORS origins section of your project.\n\n[Watch how to add Sanity data](https://www.youtube.com/watch?v=dLeu7I4RsYg).",importName:"SanityCredentialsProvider",importPath:v,props:{projectId:{type:"string",displayName:"Project ID",defaultValueHint:"b2gfz67v",defaultValue:"b2gfz67v",description:"The ID of the project to use."},dataset:{type:"string",displayName:"Dataset",defaultValueHint:"production",defaultValue:"production",description:"The dataset to use."},apiVersion:{type:"string",displayName:"API Version",defaultValueHint:"v1",description:"The API version to use (if not set, 'v1' will be used) - see https://www.sanity.io/docs/js-client#specifying-api-version."},token:{type:"string",displayName:"Token",description:"The token to use (or leave blank for unauthenticated usage) - you can create tokens in the API section of your project (i.e. https://www.sanity.io/manage/personal/project/PROJECT_ID/api#tokens)."},useCdn:{type:"boolean",displayName:"Use CDN?",defaultValueHint:!1,description:"Whether you want to use CDN ('false' if you want to ensure fresh data)."}}};function E(e){return c.createElement(b.Provider,{value:{projectId:e.projectId,dataset:e.dataset,apiVersion:e.apiVersion,token:e.token,useCdn:e.useCdn}},e.children)}var P={name:"SanityFetcher",displayName:"Sanity Fetcher",importName:"SanityFetcher",importPath:v,providesData:!0,description:"Fetches Sanity data and repeats content of children once for every row fetched. Query Cheat Sheet - GROQ <https://www.sanity.io/docs/query-cheat-sheet>",defaultStyles:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gridRowGap:"8px",gridColumnGap:"8px",padding:"8px",maxWidth:"100%"},props:{children:{type:"slot",defaultValue:{type:"vbox",styles:{padding:"8px"},children:{type:"component",name:"SanityField"}}},groq:{type:"string",displayName:"GROQ",description:"Query in GROQ.",defaultValueHint:"*[_type == 'movie']"},docType:{type:"choice",options:function(e,t){var r;return null!=(r=null==t?void 0:t.docTypes)?r:[]},displayName:"Document type",description:"Document type to be queried (*[_type == DOC_TYPE] shortcut)."},filterField:{type:"choice",displayName:"Filter field",description:"Field (from Collection) to filter by",options:function(e,t){var r;return null!=(r=null==t?void 0:t.sanityFields)?r:[]},hidden:function(e,t){return!e.docType&&!e.groq}},filterParameter:{type:"choice",displayName:"Filter Parameter",description:"Filter Parameter filter by.Read more (https://www.sanity.io/docs/groq-operators#3b7211e976f6)",options:function(e,t){var r;return null!=(r=null==t?void 0:t.queryOptions)?r:[]},hidden:function(e,t){return!e.filterField}},filterValue:{type:"string",displayName:"Filter value",description:"Value to filter by, should be of filter field type",hidden:function(e,t){return!e.filterParameter}},limit:{type:"string",displayName:"Limit",description:"Limit"},noAutoRepeat:{type:"boolean",displayName:"No auto-repeat",description:"Do not automatically repeat children for every category.",defaultValue:!1},noLayout:{type:"boolean",displayName:"No layout",description:"When set, Sanity Fetcher will not layout its children; instead, the layout set on its parent element will be used. Useful if you want to set flex gap or control container tag type.",defaultValue:!1}}};function j(e){var t,r=e.groq,i=e.docType,l=e.filterField,p=e.filterValue,f=e.filterParameter,v=e.limit,x=e.noAutoRepeat,E=e.children,P=e.className,j=e.noLayout,F=e.setControlContextData,N=new RegExp(/^[-a-z0-9]+$/i),S=new RegExp(/^(~[a-z0-9]{1}[-\w]{0,63}|[a-z0-9]{1}[-\w]{0,63})$/),O=new RegExp(/^\d{4}-\d{2}-\d{2}$/),k=m(u.useContext(b));if(!k.projectId||!N.test(k.projectId))return c.createElement("div",null,"Please specify a valid projectId, it can only contain only a-z, 0-9 and dashes.");if(!k.dataset||!S.test(k.dataset))return c.createElement("div",null,"Please specify a valid dataset, they can only contain lowercase characters, numbers, underscores and dashes, and start with tilde, and be maximum 64 characters.");if(k.apiVersion&&"v1"!==k.apiVersion&&"1"!==k.apiVersion&&"X"!==k.apiVersion){var L=new Date(k.apiVersion);if(!(O.test(k.apiVersion)&&L instanceof Date&&L.getTime()>0))return c.createElement("div",null,"Please specify a valid API version, expected `v1`, `1` or date in format `YYYY-MM-DD`.")}var _=function(e){return e.map((function(e){return e._type})).reduce((function(e,t){return e.includes(t)||e.push(t),e}),[])},I=null!=(t=a.usePlasmicQueryData(JSON.stringify(k)+"/SANITY_DOCTYPES",d(y.mark((function e(){var t;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w(k),e.next=3,t.fetch("*{_type}").then(_);case 3:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).data)&&t;!r&&i&&(r="*[_type=='"+i+"'");var C=JSON.stringify({docType:i,filterField:l,filterValue:p,filterParameter:f,limit:v,groq:r,creds:k}),V=w(k),D=a.usePlasmicQueryData(i&&r?C:null,d(y.mark((function e(){var t;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",null);case 2:return t=v?r+"]["+v+"]":r+"]",e.next=5,V.fetch(t);case 5:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).data,q=a.usePlasmicQueryData(r&&l&&p&&f&&D?C+"/filtered":null,d(y.mark((function e(){var t,n;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i||l||p||f||D){e.next=2;break}return e.abrupt("return",null);case 2:if(D){e.next=4;break}return e.abrupt("return",null);case 4:return n=Object.values(D).flatMap((function(e){return Array.isArray(e)?e:[e]})).map((function(e){return Object.entries(e).find((function(e){return e[0]===l}))})),Object.values(n).map((function(e){return Array.isArray(e)?e:[e]})).map((function(e){t="number"==typeof e[1]&&"object"!=typeof e[1]?r+" && "+l+" "+f+" "+p+"]":"number"!=typeof e[1]&&"object"!=typeof e[1]&&"string"==typeof e[1]?r+" && "+l+" "+f+' "'+p+'"]':r+" && "+l+" "+f+" "+p+"]"})),e.next=8,V.fetch(t);case 8:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).data;if(!I)return c.createElement("div",null,"Please configure the Sanity provider with a valid projectId, dataset, and token (if necessary). Don't forget to add 'https://host.plasmicdev.com' as an authorized host on the CORS origins section of your project.");if(null==F||F({docTypes:I}),!D)return c.createElement("div",null,"Please specify a valid GROQ query or select a Document type.");var T,G,A=D.map((function(e){return Object.keys(e).filter((function(t){var r=s(e,t);return"object"!=typeof r&&"image"!==r._type&&"number"==typeof r||"string"==typeof r&&!r.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/)}))})),R=Object.values(D).flatMap((function(e){return Array.isArray(e)?e:[e]})).map((function(e){return Object.entries(e).find((function(e){return e[0]===l}))}));if(Object.values(R).map((function(e){return Array.isArray(e)?e:[e]})).map((function(e){"number"==typeof e[1]&&"object"!=typeof e[1]?T=h:"number"!=typeof e[1]&&"object"!=typeof e[1]&&"string"==typeof e[1]&&(T=[{value:"==",label:"Equality"},{value:"!=",label:"Inequality"}])})),null==F||F({queryOptions:T,docTypes:I,sanityFields:A[0]}),l&&!f&&!p)return c.createElement("div",null,"Please specify a Filter Parameter and a Filter Value");if(l&&f&&!p)return c.createElement("div",null,"Please specify a Filter Value");if(!l&&!f&&p)return c.createElement("div",null,"Please specify a Filter Field and a Filter Parameter");if(!l&&f&&!p)return c.createElement("div",null,"Please specify a Filter Field and a Filter Value");var Y=o(V);if(q){if(0===q.length)return c.createElement("div",null,"No published types found");G=q.map((function(e,t){return Object.keys(e).forEach((function(t){"image"===e[t]._type&&(e[t].imgUrl=Y.image(e[t]).ignoreImageParams().toString())})),c.createElement(n.DataProvider,{key:e._id,name:"sanityItem",data:e,hidden:!0},c.createElement(n.DataProvider,{name:g(i),data:e},n.repeatedElement(t,E)))}))}else G=x?E:D.map((function(e,t){return Object.keys(e).forEach((function(t){"image"===e[t]._type&&(e[t].imgUrl=Y.image(e[t]).ignoreImageParams().toString())})),i?c.createElement(n.DataProvider,{key:e._id,name:"sanityItem",data:e,hidden:!0},c.createElement(n.DataProvider,{name:g(i),data:e},n.repeatedElement(t,E))):c.createElement(n.DataProvider,{key:e._id,name:"sanityItem",data:e},n.repeatedElement(t,E))}));return c.createElement(n.DataProvider,{name:"sanityItems",data:D},j?c.createElement(c.Fragment,null," ",G," "):c.createElement("div",{className:P}," ",G," "))}var F={name:"SanityField",displayName:"Sanity Field",importName:"SanityField",importPath:v,props:{path:{type:"string",displayName:"Path",description:"Field path - see https://www.sanity.io/docs/ids.",defaultValueHint:"castMembers.0._key"},field:{type:"choice",options:function(e,t){var r;return null!=(r=null==t?void 0:t.fields)?r:[]},displayName:"Field",description:"Field to be displayed."}}};function N(e){var t=e.className,r=e.path,a=e.field,i=e.setControlContextData,o=n.useSelector("sanityItem");if(!o)return c.createElement("div",null,"SanityField must be used within a SanityFetcher");var l=Object.keys(o).filter((function(e){var t=s(o,e);return"object"!=typeof t||"image"===t._type}));if(null==i||i({fields:l,isImage:!1}),!r&&!a)return c.createElement("div",null,"Please specify a valid path or select a field.");r||(r=a);var u=s(o,r);return null==i||i({fields:l,isImage:"image"==(null==u?void 0:u._type)}),u?"image"===(null==u?void 0:u._type)?c.createElement("img",{className:t,src:u.imgUrl}):c.createElement("div",{className:t},u):c.createElement("div",null,"Please specify a valid path.")}exports.SanityCredentialsProvider=E,exports.SanityFetcher=j,exports.SanityField=N,exports.ensure=m,exports.registerAll=function(e){var n=function(r,n){e?e.registerComponent(r,n):t(r,n)};e?e.registerGlobalContext(E,x):r(E,x),n(j,P),n(N,F)},exports.sanityCredentialsProviderMeta=x,exports.sanityFetcherMeta=P,exports.sanityFieldMeta=F;
//# sourceMappingURL=plasmic-sanity-io.cjs.production.min.js.map
