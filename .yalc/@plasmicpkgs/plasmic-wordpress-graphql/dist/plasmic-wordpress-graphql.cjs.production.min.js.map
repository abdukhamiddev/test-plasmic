{"version":3,"file":"plasmic-wordpress-graphql.cjs.production.min.js","sources":["../src/wordpress.tsx","../src/index.tsx"],"sourcesContent":["import {\n  ComponentMeta,\n  DataProvider,\n  GlobalContextMeta,\n  repeatedElement,\n  useSelector,\n} from \"@plasmicapp/host\";\nimport { usePlasmicQueryData } from \"@plasmicapp/query\";\nimport get from \"dlv\";\nimport React, { ReactNode, useContext } from \"react\";\n\nexport function ensure<T>(x: T | null | undefined): T {\n  if (x === null || x === undefined) {\n    debugger;\n    throw new Error(`Value must not be undefined or null`);\n  } else {\n    return x;\n  }\n}\n\nconst modulePath = \"@plasmicpkgs/plasmic-wordpress-graphql\";\n\ninterface WordpressProviderProps {\n  graphqlEndpoint: string;\n}\n\nconst CredentialsContext = React.createContext<\n  WordpressProviderProps | undefined\n>(undefined);\n\nexport const WordpressProviderMeta: GlobalContextMeta<WordpressProviderProps> = {\n  name: \"WordpressGraphQLProvider\",\n  displayName: \"Wordpress GraphQL Provider\",\n  description: \"The GraphQL API Endpoint of your Wordpress\",\n  importName: \"WordpressProvider\",\n  importPath: modulePath,\n  props: {\n    graphqlEndpoint: {\n      type: \"string\",\n      displayName: \"GraphQL API Endpoint\",\n      description: \"GraphQL API Endpoint of your Wordpress\",\n      defaultValue: \"https://demo.wpgraphql.com/graphql\",\n    },\n  },\n};\n\nexport function WordpressProvider({\n  graphqlEndpoint,\n  children,\n}: React.PropsWithChildren<WordpressProviderProps>) {\n  return (\n    <CredentialsContext.Provider value={{ graphqlEndpoint }}>\n      {children}\n    </CredentialsContext.Provider>\n  );\n}\n\ninterface WordpressFetcherProps {\n  children?: ReactNode;\n  className?: string;\n  noLayout?: boolean;\n  noAutoRepeat?: boolean;\n  query?: string;\n  setControlContextData?: (data: { endpoint?: string }) => void;\n}\n\nexport const WordpressFetcherMeta: ComponentMeta<WordpressFetcherProps> = {\n  name: \"WordpressGraphQLFetcher\",\n  displayName: \"Wordpress Fetcher\",\n  importName: \"WordpressFetcher\",\n  importPath: modulePath,\n  providesData: true,\n  description:\n    \"Fetches Wordpress data and repeats content of children once for every row fetched. \",\n  defaultStyles: {\n    display: \"grid\",\n    gridTemplateColumns: \"1fr 1fr 1fr 1fr\",\n    gridRowGap: \"8px\",\n    gridColumnGap: \"8px\",\n    padding: \"8px\",\n    maxWidth: \"100%\",\n  },\n  props: {\n    children: {\n      type: \"slot\",\n      defaultValue: {\n        type: \"vbox\",\n        styles: {\n          padding: \"8px\",\n        },\n        children: {\n          type: \"component\",\n          name: \"WordpressGraphQLField\",\n        },\n      },\n    },\n    query: {\n      type: \"code\",\n      lang: \"graphql\",\n      endpoint: (props, ctx) => ctx?.endpoint ?? \"\",\n    },\n    noAutoRepeat: {\n      type: \"boolean\",\n      displayName: \"No auto-repeat\",\n      description: \"Do not automatically repeat children for every entry.\",\n      defaultValue: false,\n    },\n    noLayout: {\n      type: \"boolean\",\n      displayName: \"No layout\",\n      description:\n        \"When set, Wordpress Fetcher will not layout its children; instead, the layout set on its parent element will be used. Useful if you want to set flex gap or control container tag type.\",\n      defaultValue: false,\n    },\n  },\n};\n\nfunction compact(arr: any[]) {\n  return arr.filter((x) => !!x);\n}\n\nexport function WordpressFetcher({\n  query,\n  children,\n  className,\n  noLayout,\n  noAutoRepeat,\n  setControlContextData,\n}: WordpressFetcherProps) {\n  const creds = ensure(useContext(CredentialsContext));\n  const cacheKey = JSON.stringify({\n    query,\n    creds,\n  });\n  const { data } = usePlasmicQueryData<any | null>(cacheKey, async () => {\n    if (!query) {\n      return null;\n    }\n    const data = await fetch(creds.graphqlEndpoint, {\n      method: \"POST\",\n      body: JSON.stringify(query),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n    return await data.json();\n  });\n\n  setControlContextData?.({\n    endpoint: creds.graphqlEndpoint,\n  });\n\n  if (!query) {\n    return <div>Please make a query in order to fetch data</div>;\n  }\n\n  if (!creds.graphqlEndpoint) {\n    return (\n      <div>\n        Please specify a valid API Credentials: GraphQL Endpoint of your\n        Wordpress project\n      </div>\n    );\n  }\n\n  if (!data?.data || compact(Object.values(data?.data)).length === 0) {\n    return <div>Data not found</div>;\n  }\n\n  const renderedData = noAutoRepeat\n    ? children\n    : Object.values(data?.data).flatMap((model: any, i: number) =>\n        (Array.isArray(model) ? model : [model]).map((item: any, j: number) => (\n          <DataProvider\n            key={JSON.stringify(item)}\n            name={\"currentWordpressItem\"}\n            data={item}\n          >\n            {repeatedElement(i === 0 && j === 0, children)}\n          </DataProvider>\n        ))\n      );\n  return noLayout ? (\n    <> {renderedData} </>\n  ) : (\n    <div className={className}> {renderedData} </div>\n  );\n}\n\ninterface WordpressFieldProps {\n  className?: string;\n  path?: string;\n  setControlContextData?: (data: { data: any }) => void;\n}\nexport const WordpressFieldMeta: ComponentMeta<WordpressFieldProps> = {\n  name: \"WordpressGraphQLField\",\n  displayName: \"Wordpress Field\",\n  importName: \"WordpressField\",\n  importPath: modulePath,\n  props: {\n    path: {\n      type: \"dataSelector\",\n      data: (props: any, ctx: any) => ctx?.data ?? {},\n      displayName: \"Field\",\n      description: \"Field to be displayed.\",\n    },\n  },\n};\nexport function WordpressField({\n  className,\n  path,\n  setControlContextData,\n}: WordpressFieldProps) {\n  const item = useSelector(\"currentWordpressItem\");\n\n  if (!item) {\n    return <div>WordpressField must be used within a WordpressFetcher </div>;\n  }\n\n  setControlContextData?.({\n    data: item,\n  });\n\n  if (!path) {\n    return <div>Please specify a valid path or select a field.</div>;\n  }\n  const data = get(item, path as string);\n  if (typeof data === \"object\" && data.mediaType === \"image\") {\n    return (\n      <img className={className} src={data.mediaItemUrl} srcSet={data.srcSet} />\n    );\n  } else if (\n    path.slice(-1)[0] === \"content\" ||\n    path.slice(-1)[0] === \"excerpt\"\n  ) {\n    return (\n      <div className={className} dangerouslySetInnerHTML={{ __html: data }} />\n    );\n  } else if (!data || typeof data === \"object\") {\n    return <div className={className}>Please specify a valid field.</div>;\n  } else {\n    return <div className={className}> {data} </div>;\n  }\n}\n","import registerComponent, {\n  ComponentMeta,\n} from \"@plasmicapp/host/registerComponent\";\nimport registerGlobalContext from \"@plasmicapp/host/registerGlobalContext\";\nimport {\n  WordpressFetcher,\n  WordpressFetcherMeta,\n  WordpressField,\n  WordpressFieldMeta,\n  WordpressProvider,\n  WordpressProviderMeta,\n} from \"./wordpress\";\n\nexport function registerAll(loader?: {\n  registerComponent: typeof registerComponent;\n  registerGlobalContext: typeof registerGlobalContext;\n}) {\n  const _registerComponent = <T extends React.ComponentType<any>>(\n    Component: T,\n    defaultMeta: ComponentMeta<React.ComponentProps<T>>\n  ) => {\n    if (loader) {\n      loader.registerComponent(Component, defaultMeta);\n    } else {\n      registerComponent(Component, defaultMeta);\n    }\n  };\n\n  if (loader) {\n    loader.registerGlobalContext(WordpressProvider, WordpressProviderMeta);\n  } else {\n    registerGlobalContext(WordpressProvider, WordpressProviderMeta);\n  }\n\n  _registerComponent(WordpressFetcher, WordpressFetcherMeta);\n  _registerComponent(WordpressField, WordpressFieldMeta);\n}\n\nexport * from \"./wordpress\";\n"],"names":["ensure","x","Error","modulePath","CredentialsContext","React","createContext","undefined","WordpressProviderMeta","name","displayName","description","importName","importPath","props","graphqlEndpoint","type","defaultValue","WordpressProvider","Provider","value","children","WordpressFetcherMeta","providesData","defaultStyles","display","gridTemplateColumns","gridRowGap","gridColumnGap","padding","maxWidth","styles","query","lang","endpoint","ctx","noAutoRepeat","noLayout","WordpressFetcher","arr","className","setControlContextData","creds","useContext","cacheKey","JSON","stringify","data","usePlasmicQueryData","_context","fetch","method","body","headers","Content-Type","json","Object","values","filter","length","renderedData","flatMap","model","i","Array","isArray","map","item","j","DataProvider","key","repeatedElement","WordpressFieldMeta","path","WordpressField","useSelector","get","mediaType","src","mediaItemUrl","srcSet","slice","dangerouslySetInnerHTML","__html","loader","_registerComponent","Component","defaultMeta","registerComponent","registerGlobalContext"],"mappings":"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"}