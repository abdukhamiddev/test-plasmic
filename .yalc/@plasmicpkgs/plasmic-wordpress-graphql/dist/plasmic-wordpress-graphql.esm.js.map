{"version":3,"file":"plasmic-wordpress-graphql.esm.js","sources":["../src/wordpress.tsx","../src/index.tsx"],"sourcesContent":["import {\n  ComponentMeta,\n  DataProvider,\n  GlobalContextMeta,\n  repeatedElement,\n  useSelector,\n} from \"@plasmicapp/host\";\nimport { usePlasmicQueryData } from \"@plasmicapp/query\";\nimport get from \"dlv\";\nimport React, { ReactNode, useContext } from \"react\";\n\nexport function ensure<T>(x: T | null | undefined): T {\n  if (x === null || x === undefined) {\n    debugger;\n    throw new Error(`Value must not be undefined or null`);\n  } else {\n    return x;\n  }\n}\n\nconst modulePath = \"@plasmicpkgs/plasmic-wordpress-graphql\";\n\ninterface WordpressProviderProps {\n  graphqlEndpoint: string;\n}\n\nconst CredentialsContext = React.createContext<\n  WordpressProviderProps | undefined\n>(undefined);\n\nexport const WordpressProviderMeta: GlobalContextMeta<WordpressProviderProps> = {\n  name: \"WordpressGraphQLProvider\",\n  displayName: \"Wordpress GraphQL Provider\",\n  description: \"The GraphQL API Endpoint of your Wordpress\",\n  importName: \"WordpressProvider\",\n  importPath: modulePath,\n  props: {\n    graphqlEndpoint: {\n      type: \"string\",\n      displayName: \"GraphQL API Endpoint\",\n      description: \"GraphQL API Endpoint of your Wordpress\",\n      defaultValue: \"https://demo.wpgraphql.com/graphql\",\n    },\n  },\n};\n\nexport function WordpressProvider({\n  graphqlEndpoint,\n  children,\n}: React.PropsWithChildren<WordpressProviderProps>) {\n  return (\n    <CredentialsContext.Provider value={{ graphqlEndpoint }}>\n      {children}\n    </CredentialsContext.Provider>\n  );\n}\n\ninterface WordpressFetcherProps {\n  children?: ReactNode;\n  className?: string;\n  noLayout?: boolean;\n  noAutoRepeat?: boolean;\n  query?: string;\n  setControlContextData?: (data: { endpoint?: string }) => void;\n}\n\nexport const WordpressFetcherMeta: ComponentMeta<WordpressFetcherProps> = {\n  name: \"WordpressGraphQLFetcher\",\n  displayName: \"Wordpress Fetcher\",\n  importName: \"WordpressFetcher\",\n  importPath: modulePath,\n  providesData: true,\n  description:\n    \"Fetches Wordpress data and repeats content of children once for every row fetched. \",\n  defaultStyles: {\n    display: \"grid\",\n    gridTemplateColumns: \"1fr 1fr 1fr 1fr\",\n    gridRowGap: \"8px\",\n    gridColumnGap: \"8px\",\n    padding: \"8px\",\n    maxWidth: \"100%\",\n  },\n  props: {\n    children: {\n      type: \"slot\",\n      defaultValue: {\n        type: \"vbox\",\n        styles: {\n          padding: \"8px\",\n        },\n        children: {\n          type: \"component\",\n          name: \"WordpressGraphQLField\",\n        },\n      },\n    },\n    query: {\n      type: \"code\",\n      lang: \"graphql\",\n      endpoint: (props, ctx) => ctx?.endpoint ?? \"\",\n    },\n    noAutoRepeat: {\n      type: \"boolean\",\n      displayName: \"No auto-repeat\",\n      description: \"Do not automatically repeat children for every entry.\",\n      defaultValue: false,\n    },\n    noLayout: {\n      type: \"boolean\",\n      displayName: \"No layout\",\n      description:\n        \"When set, Wordpress Fetcher will not layout its children; instead, the layout set on its parent element will be used. Useful if you want to set flex gap or control container tag type.\",\n      defaultValue: false,\n    },\n  },\n};\n\nfunction compact(arr: any[]) {\n  return arr.filter((x) => !!x);\n}\n\nexport function WordpressFetcher({\n  query,\n  children,\n  className,\n  noLayout,\n  noAutoRepeat,\n  setControlContextData,\n}: WordpressFetcherProps) {\n  const creds = ensure(useContext(CredentialsContext));\n  const cacheKey = JSON.stringify({\n    query,\n    creds,\n  });\n  const { data } = usePlasmicQueryData<any | null>(cacheKey, async () => {\n    if (!query) {\n      return null;\n    }\n    const data = await fetch(creds.graphqlEndpoint, {\n      method: \"POST\",\n      body: JSON.stringify(query),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n    return await data.json();\n  });\n\n  setControlContextData?.({\n    endpoint: creds.graphqlEndpoint,\n  });\n\n  if (!query) {\n    return <div>Please make a query in order to fetch data</div>;\n  }\n\n  if (!creds.graphqlEndpoint) {\n    return (\n      <div>\n        Please specify a valid API Credentials: GraphQL Endpoint of your\n        Wordpress project\n      </div>\n    );\n  }\n\n  if (!data?.data || compact(Object.values(data?.data)).length === 0) {\n    return <div>Data not found</div>;\n  }\n\n  const renderedData = noAutoRepeat\n    ? children\n    : Object.values(data?.data).flatMap((model: any, i: number) =>\n        (Array.isArray(model) ? model : [model]).map((item: any, j: number) => (\n          <DataProvider\n            key={JSON.stringify(item)}\n            name={\"currentWordpressItem\"}\n            data={item}\n          >\n            {repeatedElement(i === 0 && j === 0, children)}\n          </DataProvider>\n        ))\n      );\n  return noLayout ? (\n    <> {renderedData} </>\n  ) : (\n    <div className={className}> {renderedData} </div>\n  );\n}\n\ninterface WordpressFieldProps {\n  className?: string;\n  path?: string;\n  setControlContextData?: (data: { data: any }) => void;\n}\nexport const WordpressFieldMeta: ComponentMeta<WordpressFieldProps> = {\n  name: \"WordpressGraphQLField\",\n  displayName: \"Wordpress Field\",\n  importName: \"WordpressField\",\n  importPath: modulePath,\n  props: {\n    path: {\n      type: \"dataSelector\",\n      data: (props: any, ctx: any) => ctx?.data ?? {},\n      displayName: \"Field\",\n      description: \"Field to be displayed.\",\n    },\n  },\n};\nexport function WordpressField({\n  className,\n  path,\n  setControlContextData,\n}: WordpressFieldProps) {\n  const item = useSelector(\"currentWordpressItem\");\n\n  if (!item) {\n    return <div>WordpressField must be used within a WordpressFetcher </div>;\n  }\n\n  setControlContextData?.({\n    data: item,\n  });\n\n  if (!path) {\n    return <div>Please specify a valid path or select a field.</div>;\n  }\n  const data = get(item, path as string);\n  if (typeof data === \"object\" && data.mediaType === \"image\") {\n    return (\n      <img className={className} src={data.mediaItemUrl} srcSet={data.srcSet} />\n    );\n  } else if (\n    path.slice(-1)[0] === \"content\" ||\n    path.slice(-1)[0] === \"excerpt\"\n  ) {\n    return (\n      <div className={className} dangerouslySetInnerHTML={{ __html: data }} />\n    );\n  } else if (!data || typeof data === \"object\") {\n    return <div className={className}>Please specify a valid field.</div>;\n  } else {\n    return <div className={className}> {data} </div>;\n  }\n}\n","import registerComponent, {\n  ComponentMeta,\n} from \"@plasmicapp/host/registerComponent\";\nimport registerGlobalContext from \"@plasmicapp/host/registerGlobalContext\";\nimport {\n  WordpressFetcher,\n  WordpressFetcherMeta,\n  WordpressField,\n  WordpressFieldMeta,\n  WordpressProvider,\n  WordpressProviderMeta,\n} from \"./wordpress\";\n\nexport function registerAll(loader?: {\n  registerComponent: typeof registerComponent;\n  registerGlobalContext: typeof registerGlobalContext;\n}) {\n  const _registerComponent = <T extends React.ComponentType<any>>(\n    Component: T,\n    defaultMeta: ComponentMeta<React.ComponentProps<T>>\n  ) => {\n    if (loader) {\n      loader.registerComponent(Component, defaultMeta);\n    } else {\n      registerComponent(Component, defaultMeta);\n    }\n  };\n\n  if (loader) {\n    loader.registerGlobalContext(WordpressProvider, WordpressProviderMeta);\n  } else {\n    registerGlobalContext(WordpressProvider, WordpressProviderMeta);\n  }\n\n  _registerComponent(WordpressFetcher, WordpressFetcherMeta);\n  _registerComponent(WordpressField, WordpressFieldMeta);\n}\n\nexport * from \"./wordpress\";\n"],"names":["ensure","x","undefined","Error","modulePath","CredentialsContext","React","createContext","WordpressProviderMeta","name","displayName","description","importName","importPath","props","graphqlEndpoint","type","defaultValue","WordpressProvider","children","Provider","value","WordpressFetcherMeta","providesData","defaultStyles","display","gridTemplateColumns","gridRowGap","gridColumnGap","padding","maxWidth","styles","query","lang","endpoint","ctx","noAutoRepeat","noLayout","compact","arr","filter","WordpressFetcher","className","setControlContextData","creds","useContext","cacheKey","JSON","stringify","usePlasmicQueryData","fetch","method","body","headers","data","json","Object","values","length","renderedData","flatMap","model","i","Array","isArray","map","item","j","DataProvider","key","repeatedElement","WordpressFieldMeta","path","WordpressField","useSelector","get","mediaType","src","mediaItemUrl","srcSet","slice","dangerouslySetInnerHTML","__html","registerAll","loader","_registerComponent","Component","defaultMeta","registerComponent","registerGlobalContext"],"mappings":"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"}